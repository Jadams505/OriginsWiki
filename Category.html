<!DOCTYPE HTML>
<html lang="en">
	<head>
		<script>
			var catName = window.location.search.substring(1);
			function preParseCallback(){
				var firstHeader = document.getElementsByTagName("h1");
				firstHeader[0].innerText = 'Category: '+catName;
			}
			async function postParseCallback(ev){
				var content = document.getElementById('content');
				var siteMap = getSiteMap();
				var categories = await getCategories();
				var category = categories[catName];
				var siteMap = await siteMap;
				for (var i = 0; i < category.items.length; i++) {
					if(category.items[i].slice(0, 4) === 'cat:'){
						try{
							category.items.push(...categories[category.items[i].slice(4)].items);
						}catch(error){
							console.error(error);
						}
						//category.items.splice(i,1);
					}
				}
				
				var catContents = '';
				console.log(category.items);
				for (var i = 0; i < siteMap.length; i++) {
					console.log(`${siteMap[i]} ${category.items.includes(siteMap[i])} ^ ${category.blacklist}`);
					if(category.items.includes(siteMap[i]) ^ category.blacklist){
						catContents += `<div class="catitem"><a href="${siteMap[i]+linkSuffix}">${siteMap[i].replaceAll('_', ' ')}</a></div>`;
					}
				}

				content.innerHTML += catContents;
			};
		</script>
		<script src="automarkdown.js" defer></script>
		<script>
		</script>
		<link rel="stylesheet" href="styling.css"></link>
	</head>
	<body>
		<article id="content">
			<h1>Category: </h1>
			<div class="divider"></div>

		</article>
	</body>
</html>